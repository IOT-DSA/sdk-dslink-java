apply plugin: 'maven'
apply plugin: 'maven-publish'

group = 'com.datapath.maxview.org.iot-dsa'

repositories {
    mavenLocal()
}

install {
    repositories.mavenInstaller {
        pom.project {
            artifactId 'dslink'
        }
    }
}

task sourcesJar(type: Jar, dependsOn: classes) {
    classifier = 'sources'
    from sourceSets.main.allSource
}

task javadocJar(type: Jar, dependsOn: javadoc) {
    classifier = 'javadoc'
    from javadoc.destinationDir
}

artifacts {
    archives sourcesJar
    archives javadocJar
}

publishing {
   repositories {
       maven {
            credentials {
                username mavenUser
                password mavenPassword
            }
            name 'snapshots'
            url 'http://dpd-app04:8082/artifactory/libs-snapshots-local'
       }
       mavenLocal()
   }

   publications {
       mavenJava(MavenPublication){
           artifactId 'dslink'

           artifact sourcesJar {
               classifier "sources"
           }

           artifact javadocJar {
               classifier "javadoc"
           }

           pom.withXml {
               asNode().appendNode('description',
'MaxView fork of SDK for the IoT DSA protocol. \
Built from https://github.com/buzz3791/sdk-dslink-java/commit/.  \
Forked with workaround for a ClassCastException  org.slf4j.impl.Log4jLoggerAdapter cannot be cast to ch.qos.logback.classic.Logger')

           }
           
           from components.java
       }
   }

}